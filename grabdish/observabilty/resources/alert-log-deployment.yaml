## Copyright (c) 2021 Oracle and/or its affiliates.
## Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl/
apiVersion: apps/v1
kind: Deployment
metadata:
  name: alert-log
spec:
  replicas: 1
  selector:
    matchLabels:
      app: alert-log
  template:
    metadata:
      labels:
        app: alert-log
    spec:
      containers:
        - name: promtail-container
          image: grafana/promtail
          args:
            - -log.level=debug
#            - --stdin
#            - --dry-run
#            - --inspect
            - -config.file=/etc/promtail/promtail.yaml
          volumeMounts:
            - name: logs
              mountPath: /var/log/alert.log
              subPath: alert.log
            - name: promtail-config
              mountPath: /etc/promtail
#            - name: positions-config
#              mountPath: /var/log/positions.yaml
#              subPath: positions.yaml
#        - name: alert-log
#          image: busybox
#          command:
#            - sleep
#            - "3600"
#          imagePullPolicy: Always
#          volumeMounts:
#            - name: config-volume
#              mountPath: /var/log/alert.log
##              mountPath: /msdataworkshop/observability/alert.log
#              subPath: alert.log
#          ports:
#            - containerPort: 8080
      restartPolicy: Always
      volumes:
        - name: logs
          configMap:
            name: alert-log-config
        - name: promtail-config
          configMap:
            name: promtail-config
        - name: positions-config
          configMap:
            name: positions-config

#            https://grafana.com/docs/loki/latest/getting-started/troubleshooting/
#   hit refresh under inspector -> Query inspector of grafana loki explorer